pipeline {
    agent any
    environment {
        AWS_DEFAULT_REGION = 'us-east-1'
    }
    stages {
        stage('Checkout SCM') {
            steps {
                checkout scm
            }
        }
        stage('Configure and Verify AWS CLI') {
            steps {
                withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', credentialsId: 'awscredss', accessKeyVariable: 'AWS_ACCESS_KEY_ID', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]) {
                    sh '''
                    # Display truncated AWS Access Key and Secret Key
                    echo "AWS Access Key ID: ${AWS_ACCESS_KEY_ID}"
                    echo "AWS Secret Access Key: ${AWS_SECRET_ACCESS_KEY}"
                    
                    # Configure AWS CLI
                    aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID
                    aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY
                    aws configure set default.region $AWS_DEFAULT_REGION
                    
                    # Verify AWS configuration
                    aws configure list
                    aws sts get-caller-identity
                    '''
                }
            }
        }
    }
}
