pipeline {
    agent any

    environment {
        AWS_DEFAULT_REGION = 'us-east-1'
    }

    stages {
        stage('Verify AWS Credentials') {
            steps {
                script {
                    // Verify AWS credentials are set
                    if (!env.AWS_ACCESS_KEY_ID || !env.AWS_SECRET_ACCESS_KEY) {
                        error("AWS credentials are not set in the environment.")
                    } else {
                        echo "AWS_ACCESS_KEY_ID: ${env.AWS_ACCESS_KEY_ID}"
                        echo "AWS_SECRET_ACCESS_KEY: ${env.AWS_SECRET_ACCESS_KEY}"

                        // Verify AWS CLI configuration
                        try {
                            // Check if the AWS CLI is working and the credentials are valid
                            def output = sh(script: 'aws sts get-caller-identity', returnStdout: true).trim()
                            echo "AWS CLI is configured correctly. Output: ${output}"
                        } catch (Exception e) {
                            error("Failed to verify AWS CLI: ${e.message}")
                        }
                    }
                }
            }
        }
    }
}
