stage('Create EKS Cluster') {
    steps {
        withCredentials([[ 
            $class: 'AmazonWebServicesCredentialsBinding', 
            credentialsId: "awscredss", 
            accessKeyVariable: 'AWS_ACCESS_KEY_ID', 
            secretKeyVariable: 'AWS_SECRET_ACCESS_KEY' 
        ]]) {
            sh '''
                echo "Verifying AWS credentials..."
                echo "AWS_ACCESS_KEY_ID is set: $AWS_ACCESS_KEY_ID"
                echo "AWS_SECRET_ACCESS_KEY is set: $AWS_SECRET_ACCESS_KEY"
                
                echo "Creating EKS cluster..."
                eksctl create cluster \
                  --name $CLUSTER_NAME \
                  --region $REGION \
                  --nodegroup-name eks-node-group \
                  --nodes 2 \
                  --node-type t3.small \
                  --with-oidc \
                  --managed
            '''
        }
    }
}
