pipeline {
    agent any
    
    environment {
        CLUSTER_NAME = 'python-cluster'
        REGION = 'us-east-1'
        NAMESPACE = 'hello-app'
        PATH = "$HOME/.local/bin:$PATH"
    }
    
    stages {
        // ... (previous stages remain the same)

        stage('Verify AWS Credentials') {
            steps {
                withCredentials([[
                    $class: 'AmazonWebServicesCredentialsBinding',
                    credentialsId: "awscredss",
                    accessKeyVariable: 'AWS_ACCESS_KEY_ID',
                    secretKeyVariable: 'AWS_SECRET_ACCESS_KEY'
                ]]) {
                    sh '''
                        echo "Verifying AWS credentials..."
                        aws sts get-caller-identity
                        if [ $? -eq 0 ]; then
                            echo "AWS credentials are valid and working."
                        else
                            echo "Failed to verify AWS credentials."
                            exit 1
                        fi
                    '''
                }
            }
        }

        stage('Create Cluster') {
            steps {
                withCredentials([[
                    $class: 'AmazonWebServicesCredentialsBinding',
                    credentialsId: "awscredss",
                    accessKeyVariable: 'AWS_ACCESS_KEY_ID',
                    secretKeyVariable: 'AWS_SECRET_ACCESS_KEY'
                ]]) {
                    sh '''
                        echo "Creating EKS cluster..."
                        eksctl create cluster --name ${CLUSTER_NAME} --region ${REGION} --nodes-min=1
                    '''
                }
            }
        }

        // ... (subsequent stages remain the same)
    }
}
